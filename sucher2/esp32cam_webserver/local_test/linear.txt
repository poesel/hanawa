## Visuell korrekter Farbmittelwert

Das Problem beim einfachen Mittelwert: RGB-Werte sind gamma-kodiert (nicht linear). Ein arithmetischer Mittelwert von z.B. RGB(0, 0, 255) und RGB(255, 255, 0) ergibt RGB(127, 127, 127) – ein dunkles Grau, obwohl beide Ausgangsfarben hell sind.

## Der richtige Prozess

### 1. sRGB → lineares RGB (für jeden Kanal)

Normalisiere zuerst den Wert auf 0.0 bis 1.0 (teile durch 255), dann:

```
wenn Wert ≤ 0.04045:
    linear = Wert / 12.92
sonst:
    linear = ((Wert + 0.055) / 1.055)^2.4
```

### 2. Mittelwert im linearen Raum

Berechne den arithmetischen Mittelwert für jeden Kanal:

```
R_linear_mittel = (R_linear₁ + R_linear₂ + ... + R_linearₙ) / n
```

### 3. Lineares RGB → sRGB (zurück konvertieren)

```
wenn Wert ≤ 0.0031308:
    sRGB = Wert × 12.92
sonst:
    sRGB = 1.055 × Wert^(1/2.4) - 0.055
```

Multipliziere das Ergebnis wieder mit 255 und runde.

## Python-Beispiel

```python
import numpy as np

def srgb_to_linear(value):
    """Konvertiert sRGB (0-255) zu linear RGB (0-1)"""
    v = value / 255.0
    if v <= 0.04045:
        return v / 12.92
    else:
        return ((v + 0.055) / 1.055) ** 2.4

def linear_to_srgb(value):
    """Konvertiert linear RGB (0-1) zu sRGB (0-255)"""
    if value <= 0.0031308:
        v = value * 12.92
    else:
        v = 1.055 * (value ** (1/2.4)) - 0.055
    return int(round(v * 255))

def average_colors(colors):
    """Berechnet visuell korrekten Mittelwert von RGB-Farben"""
    # In linearen Raum konvertieren
    linear_colors = np.array([[srgb_to_linear(c) for c in rgb] for rgb in colors])
    
    # Mittelwert pro Kanal
    linear_avg = np.mean(linear_colors, axis=0)
    
    # Zurück zu sRGB
    srgb_avg = [linear_to_srgb(v) for v in linear_avg]
    
    return tuple(srgb_avg)

# Beispiel
colors = [
    (0, 0, 255),      # Blau
    (255, 255, 0)     # Gelb
]

result = average_colors(colors)
print(f"Visuell korrekt: RGB{result}")
print(f"Einfacher Mittelwert: RGB(127, 127, 127)")
```

**Ergebnis:** Der visuell korrekte Mittelwert von Blau und Gelb ist RGB(188, 188, 115) – ein helles Grüngrau statt dunklem Grau.

## Warum ist das wichtig?

Die gamma-korrigierte Berechnung respektiert die menschliche Helligkeitswahrnehmung. Der Unterschied ist besonders deutlich bei:
- Starken Kontrasten (dunkle + helle Farben)
- Großen Farbflächen
- Gradienten und Mischungen

Für präzise Bildverarbeitung solltest du immer im linearen Farbraum rechnen.